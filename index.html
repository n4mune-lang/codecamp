<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Geri Sayım</title>
<style>
*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}
body{
  font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
  background:#06080a;
  color:#fff;
  overflow:hidden;
}
.bg{position:fixed;inset:0;overflow:hidden;pointer-events:none}
.bg__layer{
  position:absolute;left:50%;top:50%;
  transform:translate(-50%,-50%);
  width:140vw;height:140vh;
  background-image: url('https://i.hizliresim.com/j6s5dzh.jpg');
  background-size:cover;background-position:center;
  filter:brightness(0.55) saturate(1.05) contrast(1.02);
  will-change:transform;transition:transform 0.2s linear;
}
.wrap{position:relative;z-index:10;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:2rem;flex-direction:column;gap:20px}
.card{
  background:rgba(0,0,0,0.25);
  border:1px solid rgba(255,255,255,0.06);
  padding:2.2rem;border-radius:16px;
  backdrop-filter:blur(6px);
  max-width:980px;width:100%;
  text-align:center;
}
h1.big{font-size:clamp(1.5rem,3.5vw,2.2rem);letter-spacing:-1px;margin-bottom:.75rem;line-height:1.2}

.countdown-wrapper{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:12px;
  flex-direction:row;
}
.countdown{
  display:flex;gap:12px;justify-content:center;align-items:center;
}
.countdown .unit{
  background:rgba(255,255,255,0.04);
  padding:12px 14px;
  border-radius:10px;
  min-width:86px;
  text-align:center;
  border:1px solid rgba(255,255,255,0.04);
  position:relative;
  overflow:hidden;
}
.countdown .unit .value{
  font-size:1.5rem;font-weight:700;
  display:inline-block;
}
.countdown .unit .value.animate{
  animation: fade 0.35s ease-in-out;
}
.countdown .unit .label{font-size:.72rem;opacity:.8;margin-top:6px}
#afterText{
  font-size:0.85rem;
  opacity:0.8;
  margin-left:12px;
  margin-bottom:0;
  white-space:nowrap;
  align-self:flex-end;
  margin-top:25px;
}
@keyframes fade{
  0%{transform:translateY(-18px);opacity:0;}
  50%{transform:translateY(5px);opacity:0.5;}
  100%{transform:translateY(0);opacity:1;}
}

.socials{display:flex;gap:14px;align-items:flex-start;justify-content:center;margin-top:1rem;flex-wrap:wrap}
.widget{
  display:flex;flex-direction:column;
  padding:10px 14px;border-radius:12px;
  border:1px solid rgba(0,0,0,0.15);min-width:260px;color:#fff;
  transition:transform 0.2s;
  cursor:pointer;
  text-align:left;
}
.widget:hover{transform:scale(1.03);}
.widget .header{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.widget .header img{width:24px;height:24px;}
.widget .header span{font-weight:700;font-size:1rem;}
.widget .body{display:flex;align-items:center;gap:12px;}
.widget .body img.icon{width:56px;height:56px;border-radius:8px;object-fit:cover}
.widget .meta{display:flex;flex-direction:column}
.widget .meta .title{font-weight:700;font-size:1rem;text-align:left;}
.widget .meta .sub{font-size:.85rem;opacity:.85;text-align:left;}

.widget.spotify{background:#1DB954;}
.widget.discord{background:#5865F2;}
.widget.discord .body img.icon{border-radius:50%;}
.widget.github{background:#24292F;}
.widget.github .meta .sub{color:#aaa;}

.progress-container{display:flex;gap:8px;margin-top:20px;justify-content:center}
.progress-bar{flex:1;height:12px;background:rgba(255,255,255,0.1);border-radius:6px;overflow:hidden;position:relative}
.progress-bar .fill{height:100%;width:0;background:#1DB954;border-radius:6px;transition:width 3s linear;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;font-weight:700;font-size:12px}
.progress-bar .percent{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-size:12px;font-weight:700}

.second-card{background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);padding:2rem;border-radius:16px;backdrop-filter:blur(6px);width:100%;max-width:980px;text-align:left;display:flex;flex-direction:column;gap:16px}
.second-card h2{margin-bottom:12px;font-size:1.3rem;font-weight:700}
.second-card .load-item{display:flex;flex-direction:column;gap:6px}
.second-card .load-label{font-size:0.9rem;opacity:0.8}
.second-card .load-bar{height:18px;background:rgba(255,255,255,0.06);border-radius:9px;overflow:hidden;position:relative}
.second-card .load-bar .fill {
  height: 100%;
  width: 0;
  background: #8B4513;
  border-radius: 7px;
  transition: width 3s linear;
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding-right:8px;
  font-weight:700;
  font-size:12px;
  color:#fff;
}

#forumCard{display:none;background:rgba(0,0,0,0.25);border:1px solid rgba(255,255,255,0.06);padding:1.5rem;border-radius:16px;backdrop-filter:blur(6px);width:100%;max-width:500px;flex-direction:column;gap:10px;margin-top:20px;position:relative;z-index:30;}
#forumCard textarea{width:100%;padding:10px;border-radius:8px;border:none;resize:none;height:80px;background:rgba(255,255,255,0.03);color:#fff}
#forumCard button{padding:8px 12px;border-radius:6px;border:none;background:#8B4513;color:#fff;cursor:pointer;}
#forumCard .close-btn{position:absolute;top:10px;right:10px;width:24px;height:24px;border-radius:50%;background:#8B4513;color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;font-weight:bold;font-size:14px;}

#suggestBtn{position:fixed;top:16px;right:16px;padding:10px 14px;border-radius:8px;border:none;background:#8B4513;color:#fff;cursor:pointer;z-index:40;box-shadow:0 6px 18px rgba(0,0,0,0.4)}
#profileBadge{position:fixed;top:16px;left:16px;padding:8px 10px;border-radius:10px;background:rgba(0,0,0,0.35);border:1px solid rgba(255,255,255,0.04);display:flex;align-items:center;gap:8px;z-index:40}
#profileBadge img{width:40px;height:40px;border-radius:50%;object-fit:cover}
#profileBadge .name{font-weight:700;font-size:0.95rem}
#notification{position:fixed;top:70px;left:50%;transform:translateX(-50%);background:rgba(0,0,0,0.8);padding:10px 14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);z-index:50;display:none}

.load-percent{position:absolute;right:10px;top:50%;transform:translateY(-50%);font-weight:700;font-size:12px;color:#fff}

@media (max-width:720px){
  .card{padding:1.2rem}
  .countdown{flex-wrap:wrap}
  h1.big{font-size:clamp(1.3rem,4vw,1.8rem)}
  #profileBadge{padding:6px 8px}
}
</style>
</head>
<body>

<div class="bg" aria-hidden="true">
  <div class="bg__layer" id="bgLayer"></div>
</div>

<div id="profileBadge" style="display:none" aria-hidden="false">
  <img id="profileImg" src="https://cdn.discordapp.com/embed/avatars/0.png" alt="Profil">
  <div>
    <div class="name" id="profileName">DiscordKullanici</div>
    <div style="font-size:0.75rem;opacity:0.8" id="profileDisc">#0000</div>
  </div>
</div>

<div id="notification"></div>

<div class="wrap">

<div class="card" role="main">
<h1 class="big">Discord botları için kod paylaşım sitesi şu zaman aktif olacaktır:</h1>
<div class="countdown-wrapper">
  <div class="countdown" id="countdown" aria-live="polite">
    <div class="unit"><div class="value" id="days">0</div><div class="label">Gün</div></div>
    <div class="unit"><div class="value" id="hours">00</div><div class="label">Saat</div></div>
    <div class="unit"><div class="value" id="minutes">00</div><div class="label">Dakika</div></div>
    <div class="unit"><div class="value" id="seconds">00</div><div class="label">Saniye</div></div>
  </div>
  <span id="afterText">sonra...</span>
</div>

<div class="socials">
  <div class="widget spotify" id="spotify" onclick="window.open('https://open.spotify.com/user/31ksdwh2vg2wswtd4da2bhjw7zpu?si=f8984cf7c36b447d','_blank')">
    <div class="header"><img src="https://storage.googleapis.com/pr-newsroom-wp/1/2023/05/Spotify_Primary_Logo_RGB_White.png" alt="Spotify logo"><span>Spotify</span></div>
    <div class="body">
      <img class="icon" id="spImg" src="https://dummyimage.com/300x300/111/fff&text=Spotify" alt="Albüm kapağı">
      <div class="meta">
        <div class="title" id="spTitle">Çalmıyor</div>
        <div class="sub" id="spSub">Bilgi alınamadı</div>
      </div>
    </div>
  </div>

  <div class="widget discord" id="discord" onclick="window.open('https://discord.gg/duVuC85Uz6','_blank')">
    <div class="header"><img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/discord-white-icon.png" alt="Discord logo"><span>Discord</span></div>
    <div class="body">
      <img class="icon" id="dcImg" src="https://dummyimage.com/300x300/5865f2/fff&text=DC" alt="Discord avatar">
      <div class="meta">
        <div class="title" id="dcTitle">Discord</div>
        <div class="sub" id="discordName">@kullanici#0000</div>
      </div>
    </div>
  </div>

  <div class="widget github" id="github" onclick="if(gh)window.open(gh.html_url,'_blank')">
    <div class="header">
      <img src="https://uxwing.com/wp-content/themes/uxwing/download/brands-and-social-media/github-white-icon.png" alt="GitHub logo">
      <span>GitHub</span>
    </div>
    <div class="body">
      <img class="icon" id="ghImg" src="https://dummyimage.com/300x300/111/fff&text=GitHub" alt="GitHub avatar">
      <div class="meta">
        <div class="title" id="ghName">Yükleniyor...</div>
        <div class="sub" id="ghSub">GitHub profiline bakmak için tıkla</div>
      </div>
    </div>
  </div>
</div>
</div>

<div class="second-card">
  <h2>Yükleme Durumları</h2>
  <div class="load-item">
    <div class="load-label">Veritabanı</div>
    <div class="load-bar"><div class="fill" id="dbLoad" data-target="22">1%</div><div class="load-percent" id="dbPct">1%</div></div>
  </div>
  <div class="load-item">
    <div class="load-label">Sunucu</div>
    <div class="load-bar"><div class="fill" id="serverLoad" data-target="36">1%</div><div class="load-percent" id="serverPct">1%</div></div>
  </div>
  <div class="load-item">
    <div class="load-label">Kategoriler</div>
    <div class="load-bar"><div class="fill" id="catLoad" data-target="12">1%</div><div class="load-percent" id="catPct">1%</div></div>
  </div>
</div>

<div id="forumCard">
  <div class="close-btn" id="closeBtn">X</div>
  <h2>İstek / Öneri Gönder</h2>
  <textarea id="forumInput" placeholder="Mesajınızı yazın..."></textarea>
  <button id="sendBtn">Gönder</button>
</div>

</div>

<button id="suggestBtn" aria-label="İstek / Öneri">İstek / Öneri</button>

<script>
/* ------------------ Parallax BG ------------------ */
(function(){
  const l=document.getElementById('bgLayer'),M=50,D=0.8;
  let tX=0,tY=0,cX=0,cY=0,r=null;
  function p(x,y){tX=-(x/window.innerWidth-0.5)*M;tY=-(y/window.innerHeight-0.5)*M;if(!r)r=requestAnimationFrame(f);}
  window.addEventListener('mousemove',e=>p(e.clientX,e.clientY),{passive:true});
  function f(){cX+=(tX-cX)*D;cY+=(tY-cY)*D;l.style.transform=`translate3d(${cX}px, ${cY}px, 0) translate(-50%, -50%)`;if(Math.abs(tX-cX)<0.02&&Math.abs(tY-cY)<0.02){cancelAnimationFrame(r);r=null;return;}r=requestAnimationFrame(f);}
})();

/* ------------------ Countdown (animasyonlu) ------------------ */
(function(){
  const d=document.getElementById('days'),h=document.getElementById('hours'),m=document.getElementById('minutes'),s=document.getElementById('seconds');
  // hedefi localStorage'dan al veya varsayılan 60 gün sonrasını ayarla
  let tgt = localStorage.getItem('countdownTarget');
  if(!tgt){ tgt = new Date(Date.now() + 60*24*60*60*1000).toISOString(); localStorage.setItem('countdownTarget', tgt); }
  tgt = new Date(tgt);
  function pad(n){ return String(n).padStart(2,'0'); }
  function animateValue(el, v){
    // sadece değiştiyse animasyon uygula
    if(el.textContent !== String(v)){
      el.textContent = v;
      el.classList.remove('animate');
      void el.offsetWidth;
      el.classList.add('animate');
    }
  }
  function u(){
    const t = tgt - Date.now();
    if(t<=0){
      animateValue(d,'0'); animateValue(h,'00'); animateValue(m,'00'); animateValue(s,'00');
      return;
    }
    const sec = Math.floor(t/1000);
    const D = Math.floor(sec/86400);
    const H = Math.floor((sec%86400)/3600);
    const M = Math.floor((sec%3600)/60);
    const S = sec%60;
    animateValue(d,D); animateValue(h,pad(H)); animateValue(m,pad(M)); animateValue(s,pad(S));
  }
  u(); setInterval(u,1000);
})();

/* ------------------ Discord & Spotify via Lanyard ------------------
   Not: Lanyard sağlarsa gerçek spotify verisi gelir. Eğer çalmıyor
   ise son çalınanı localStorage'dan gösteririz.
---------------------------------------------------------------*/
(function(){
  const dn=document.getElementById('discordName'),di=document.getElementById('dcImg'),st=document.getElementById('spTitle'),ss=document.getElementById('spSub'),si=document.getElementById('spImg');
  const uid="1385334666483208213"; // lanyard user id (örnek)
  let curS=null;
  // local last spotify
  function saveLast(songObj){
    try{ localStorage.setItem('lastSpotify', JSON.stringify(songObj)); }catch(e){}
  }
  function loadLast(){
    try{ const s=localStorage.getItem('lastSpotify'); return s?JSON.parse(s):null; }catch(e){return null;}
  }
  async function fL(){
    try{
      const r=await fetch(`https://api.lanyard.rest/v1/users/${uid}`);
      const j=await r.json();
      if(!j.success) throw 0;
      const d=j.data;
      const u=d.discord_user;
      di.src = u.avatar ? `https://cdn.discordapp.com/avatars/${u.id}/${u.avatar}.png?size=128` : 'https://cdn.discordapp.com/embed/avatars/0.png';
      dn.textContent = u.username;
      // spotify kontrol
      if(d.listening_to_spotify){
        curS = d.spotify;
        // eğer yeni şarkıysa kaydet
        const last = loadLast();
        if(!last || last.song !== curS.song || last.album_art_url !== curS.album_art_url){
          saveLast({song:curS.song, album_art_url:curS.album_art_url, artist:curS.artist});
        }
        st.textContent = curS.song;
        si.src = curS.album_art_url;
        // zaman gösterimi ayrıca güncellenecek
        updateSpotifyTime();
      } else {
        // çalmıyorsa en son çalınanı göster
        curS = null;
        const last = loadLast();
        if(last){
          st.textContent = last.song;
          si.src = last.album_art_url || 'https://dummyimage.com/300x300/111/fff&text=Spotify';
          ss.textContent = 'En Son Çalındı';
        } else {
          st.textContent = 'Çalmıyor';
          si.src = 'https://dummyimage.com/300x300/111/fff&text=Spotify';
          ss.textContent = 'Bilgi alınamadı';
        }
      }
    } catch(e){
      dn.textContent="Discord verisi yok";
      st.textContent="Spotify: Bağlantı yok";
      ss.textContent='';
      console.error('Lanyard hata', e);
    }
  }
  function msToMMSS(sec){
    const mm = Math.floor(sec/60).toString().padStart(2,'0');
    const ss = (sec%60).toString().padStart(2,'0');
    return `${mm}:${ss}`;
  }
  function updateSpotifyTime(){
    if(!curS || !curS.timestamps) return;
    const n = Date.now();
    let elapsed = Math.floor((n - curS.timestamps.start)/1000);
    const total = Math.floor((curS.timestamps.end - curS.timestamps.start)/1000);
    if(elapsed >= total){
      elapsed = total; // durdur
    }
    ss.textContent = `${curS.artist} • ${msToMMSS(elapsed)} / ${msToMMSS(total)}`;
  }
  // Poll Lanyard frequently but not too often
  fL();
  setInterval(fL, 5000); // 5s
  setInterval(()=>{ if(curS) updateSpotifyTime(); }, 1000);
})();

/* ------------------ GitHub user yükle ------------------ */
let gh=null;
async function fGH(u){
  try{
    const r=await fetch(`https://api.github.com/users/${u}`);
    const d=await r.json();
    gh=d;
    document.getElementById('ghImg').src=d.avatar_url;
    document.getElementById('ghName').textContent=d.login;
    document.getElementById('ghSub').textContent=`Public repos: ${d.public_repos} • Followers: ${d.followers}`;
  }catch(e){
    document.getElementById('ghName').textContent="GitHub yüklenemedi";
    document.getElementById('ghSub').textContent='';
    console.error('GitHub hata', e);
  }
}
fGH("n4mune-lang");

/* ------------------ Yükleme çubukları: 3s animasyon, 15s döngü ------------------ */
function startLoadCycle(idFill, idPct){
  const fill = document.getElementById(idFill);
  const pct = document.getElementById(idPct);
  const target = Number(fill.dataset.target) || 50;
  function run(){
    // başlat: 1%
    fill.style.transition = 'none';
    fill.style.width = '1%';
    fill.textContent = '1%';
    pct.textContent = '1%';
    // küçük gecikme sonra 3s içinde hedefe gel
    requestAnimationFrame(()=>{ // allow layout
      setTimeout(()=>{
        fill.style.transition = 'width 3s linear';
        fill.style.width = target + '%';
        fill.textContent = target + '%';
        // ayrıca yan yüzde
        pct.textContent = target + '%';
      }, 50);
    });
  }
  run();
  // 15 saniyede bir tekrar baştan yükle
  const interval = setInterval(()=>{ run(); }, 15000);
  // hemen döndür ki çağıran referans saklayabilsin
  return () => { clearInterval(interval); };
}
const stopDb = startLoadCycle('dbLoad','dbPct');
const stopServer = startLoadCycle('serverLoad','serverPct');
const stopCat = startLoadCycle('catLoad','catPct');

/* ------------------ Forum / OAuth / Webhook / Profil Uygulamaları ------------------ */
const oauthUrl = "https://discord.com/oauth2/authorize?client_id=1420075937772339220&response_type=code&redirect_uri=https%3A%2F%2Fn4mune-lang.github.io%2Fcodecamp%2F&scope=identify";
const webhookUrl = "https://discord.com/api/webhooks/1420047378857066598/pMR3I5p4Pk3Qg4NCcfxS-8ktrUZDW5CW5CW1xG11Iq5R3bsa5K8DtxtvpxnCc_3fA2njCzA";

let discordUser = null;

function loadDiscordUser(){
  try{
    const storedUser = localStorage.getItem('discordUser');
    if(storedUser && storedUser !== 'undefined' && storedUser !== 'null'){
      discordUser = JSON.parse(storedUser);
      renderProfileBadge();
      console.log('Kullanıcı yüklendi:', discordUser);
    }
  }catch(err){
    console.error('Kullanıcı yüklenirken hata', err);
    localStorage.removeItem('discordUser');
    discordUser = null;
  }
}
loadDiscordUser();

function renderProfileBadge(){
  if(!discordUser) return;
  const badge = document.getElementById('profileBadge');
  const img = document.getElementById('profileImg');
  const name = document.getElementById('profileName');
  const disc = document.getElementById('profileDisc');
  img.src = discordUser.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png';
  name.textContent = discordUser.username || 'DiscordKullanici';
  disc.textContent = discordUser.discriminator ? ('#' + discordUser.discriminator) : '#0000';
  badge.style.display = 'flex';
}

// Query param code kontrolü (kullanıcı backend ile token exchange yapmadığı için tarayıcıda demo bir user objesi oluşturuyoruz)
const params = new URLSearchParams(window.location.search);
const code = params.get('code');
if(code){
  try{
    // Gerçek uygulamada burada backend'e code gönderilip user bilgileri alınır.
    // Tarayıcı demo'su: geçici user oluştur (kullanıcı yetkilendirme yaptığını varsayıyoruz)
    const userObj = {
      id: 'temp_' + Date.now(),
      username: 'DiscordKullanici',
      discriminator: '0000',
      avatar: 'https://cdn.discordapp.com/embed/avatars/1.png'
    };
    discordUser = userObj;
    localStorage.setItem('discordUser', JSON.stringify(userObj));
    // göster: profil rozeti (ama formu otomatik açmıyoruz: kullanıcı tekrar butona bastığında form açılacak)
    renderProfileBadge();
    // temizle URL param
    window.history.replaceState({}, document.title, window.location.pathname);
  } catch(e){
    console.error('Yetkilendirme sonrası user oluşturma hatası', e);
  }
}

function showForum(){
  document.getElementById("forumCard").style.display = "flex";
  document.getElementById("forumInput").focus();
}
function hideForum(){
  document.getElementById("forumCard").style.display = "none";
  document.getElementById("forumInput").value = "";
}
document.getElementById("closeBtn").addEventListener("click", hideForum);

document.getElementById("suggestBtn").addEventListener("click", () => {
  if(!discordUser){
    // yönlendir: oauth
    window.location.href = oauthUrl;
  } else {
    showForum();
  }
});

// Gönderme: embedli webhook
document.getElementById("sendBtn").addEventListener("click", async () => {
  const msg = document.getElementById("forumInput").value.trim();
  if(!msg) return alert("Mesaj boş olamaz");
  try{
    // embed payload
    const embed = {
      title: "Yeni İstek / Öneri",
      description: msg,
      color: 14205356, // kahverengimsi
      author: {
        name: `${discordUser.username} ${discordUser.discriminator ? ('#'+discordUser.discriminator) : ''}`,
        icon_url: discordUser.avatar || 'https://cdn.discordapp.com/embed/avatars/0.png'
      },
      timestamp: new Date().toISOString()
    };
    const payload = { embeds: [embed] };
    // Gönderme (uyarı: bazı tarayıcılarda CORS engeli olabilir)
    await fetch(webhookUrl, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });
    // bildirim göster
    showNotification('Mesajınız İletildi! Takip Etmek İçin: <a href="https://discord.gg/duVuC85Uz6" target="_blank" style="color:#1DB954;text-decoration:underline">Buraya Tıkla</a>');
    hideForum();
  } catch(e){
    console.error('Gönderme hatası', e);
    alert("Mesaj gönderilemedi (tarayıcı CORS veya ağ hatası olabilir).");
  }
});

function showNotification(html){
  const n = document.getElementById('notification');
  n.innerHTML = html;
  n.style.display = 'block';
  setTimeout(()=>{ n.style.opacity = '1'; }, 10);
  setTimeout(()=>{ n.style.opacity = '0'; setTimeout(()=>{ n.style.display = 'none'; n.innerHTML = ''; }, 400); }, 2000);
}

/* ------------------ Global error log (kullanıcıya gözükmez) ------------------ */
window.addEventListener('error', function(e) {
  console.error('Global hata:', e.error || e.message || e);
});
</script>
</body>
</html>
